**English** | [简体中文](./README_zh-CN.md)

---

# ABAQUS INP Extraction Tool

Extract specified subsystems from large INP files

---

## 📍 Project Overview

### Limitations of ABAQUS CAE

When ABAQUS/CAE handles orphan meshes:
- Lacks geometric references, preventing the use of graphical selection tools
- Set operations (union, intersection) rely on geometric queries and fail for orphan meshes
- Manual operations on large models (thousands of ELSETs) are error-prone

### Advantages of Source File Filtering

INP files are structured text containing complete topological relationships:
- Clear node-element-ELSET hierarchy
- Well-defined material-section-constraint dependencies
- Precise matching through names or keywords

### Purpose of This Tool

**Workflow**:
1. **Parse INP file** — Identify main keyword blocks (NODE, ELEMENT, MATERIAL, SECTION, Constraint, etc.)
2. **Dependency tracking** — Recursively collect complete dependency chains: ELSET → nodes → materials → constraints
3. **Batch generation** — Generate independent INP files by system configuration, preserving topological order
4. **Intelligent caching** — Automatically detect file modifications to avoid redundant parsing, supporting multiple batch extractions

**Extracted content (model definition)**:
- Geometry: nodes (*NODE), elements (*ELEMENT)
- Sets: NSET, ELSET, Surface
- Properties: materials (*MATERIAL), sections (*SECTION)
- Connections: Connector Behavior
- Constraints: Coupling, Rigid Body, MPC, Tie, Equation, Embedded Region, etc.

**Not extracted (analysis definition)**:
- Boundary conditions (*BOUNDARY)
- Loads (*CLOAD, *DLOAD, *PRESSURE)
- Analysis steps (*STEP)
- Output requests (*OUTPUT, *NODE PRINT, *EL PRINT)
- Initial conditions (*INITIAL CONDITIONS)

> The extracted INP files contain the complete model structure and can be imported into ABAQUS/CAE to add boundary conditions and loads for analysis

---

## 📁 Project Structure

```
extract/
├── batch.py                        # Batch extraction scheduler
├── scripts/                        # Extraction scripts
│   ├── extract.py                  # ELSET extraction
│   ├── parse.py                    # INP parsing
│   └── extractor.py                # Dependency tracking
└── silverado/                      # Example model
    ├── silverado.inp               # Source file
    ├── silverado.inp.cache.pkl     # Parsing cache
    ├── elsets.py                   # ELSET dictionary to extract
    └── silverado_*.inp             # Extracted subsystems
```

**Core file descriptions**:
- `batch.py` — Batch extract multiple systems
- `scripts/extract.py` — Command-line extraction of specified ELSET(s) (supports single or multiple)
- `scripts/parse.py` — Parse INP file structure (identify nodes, elements, materials, etc.)
- `scripts/extractor.py` — Collect complete dependencies (automatically includes materials, constraints, etc.)
- `silverado/elsets.py` — Define which ELSETs to extract (manual grouping configuration)

---

## 🚀 Quick Start

### Processing Your INP File

This tool supports common ABAQUS INP files (orphan mesh models generated by preprocessing software such as HyperMesh, ANSA, PATRAN, GMSH, etc.).

**Step 1: Prepare files**
```bash
mkdir your_model
cp your_file.inp your_model/model.inp
```

**Step 2: Create extraction configuration**

Define the ELSETs to extract in `your_model/elsets.py`:
```python
SYSTEMS = {
    'system1': [
        'ELSET_NAME_1',
        'ELSET_NAME_2',
        # ... add required ELSETs
    ],
}
```

**Step 3: Extract**

```bash
# Command-line extraction (single or multiple ELSETs)
python scripts/extract.py your_model/model.inp --elsets "ELSET1,ELSET2" -o output.inp

# Batch extraction (multiple systems)
python batch.py your_model/model.inp
```

---

## 💡 Example Demonstration

The following demonstrates actual results using the Silverado vehicle model (365MB, 3000+ ELSETs).

### Command-line Extraction Example

```bash
# Extract single ELSET
python scripts/extract.py silverado/silverado.inp --elsets "P2000293;mc-disk" -o output.inp

# Extract multiple ELSETs (comma-separated)
python scripts/extract.py silverado/silverado.inp --elsets "P2000293;mc-disk,P2000016;13-bw-bodymnt-disk" -o brake.inp
```

**Output**:
```text
[Target] P2000293;mc-disk, P2000016;13-bw-bodymnt-disk
[Elements] 1017 elements, 1089 nodes
[Constraints] 2 constraints
```

---

### Batch Extraction Example

**Silverado configuration file** (`silverado/elsets.py`):
```python
SYSTEMS = {
    'body': [151 ELSETs],
    'brake': [6 ELSETs],
    'powertrain': [56 ELSETs],
    'steering': [11 ELSETs],
    'suspension': [97 ELSETs],
    'wheel': [25 ELSETs],
}
```

**Execute batch extraction**:
```bash
python batch.py silverado/silverado.inp
```

**Output**:
```text
[Batch Extraction] SILVERADO
[Source file] silverado/silverado.inp
[Config file] F:\...\extract\silverado\elsets.py
----------------------------------------
  body                 151 components
  brake                  6 components
  powertrain            56 components
  steering              11 components
  suspension            97 components
  wheel                 25 components
----------------------------------------

[brake] Extracting...
  [Target] 6 ELSETs: P2000016;13-bw-bodymnt-disk-middle, ...
  [Elements] 1603 elements, 1710 nodes
  [Constraints] 3 constraints, 3 Nsets
  [Properties] 6 sections

[powertrain] Extracting...
  [Target] 56 ELSETs: P2000121;101-bw-engineframesuprt, ...
  [Elements] 31660 elements, 34709 nodes
  [Constraints] 1250 constraints, 90 Nsets
  [Properties] 56 sections

...

[Complete] Batch extraction finished
```

**Generated files** (in same directory as source file):
```
silverado/
├── silverado_body.inp       (30MB, 225856 elements)
├── silverado_brake.inp      (214KB, 1603 elements)
├── silverado_powertrain.inp (4.7MB, 31660 elements)
├── silverado_steering.inp   (256KB, 1743 elements)
├── silverado_suspension.inp (3.2MB, 20557 elements)
└── silverado_wheel.inp      (5.4MB, 41937 elements)
```

---

## 🔧 Extensions

### Adding New Groups

Add new system groups in the existing model's `elsets.py`:

```python
SYSTEMS = {
    # ... existing groups
    'exhaust': [
        'P2000346;mc-exhaust-body',
        'P2000347;exhaust-pipe',
        # ... manually add required ELSETs
    ],
}
```

---

### Custom Combined Groups

To create combined systems (e.g., front axle = suspension + wheel + steering + brake), first define base lists, then combine:

```python
# Base systems
_SUSPENSION = ['P2000144;20-fr-suspension...', ...]
_WHEEL = ['P2000143;19-fr-sparetiremount', ...]
_STEERING = ['P2000345;mc-steer-cylinder', ...]
_BRAKE = ['P2000016;13-bw-bodymnt-disk...', ...]

SYSTEMS = {
    'suspension': _SUSPENSION,
    'wheel': _WHEEL,
    'steering': _STEERING,
    'brake': _BRAKE,

    # Combined system: front axle = suspension + wheel + steering + brake
    'front_axle': sorted(set(_SUSPENSION + _WHEEL + _STEERING + _BRAKE)),
}
```

---

## 📄 License

MIT License

---

## 📊 Data Source

The Silverado vehicle model used in this project is from open-source data provided by George Mason University:

**2007 Chevrolet Silverado Finite Element Model**
https://www.ccsa.gmu.edu/models/2007-chevrolet-silverado/

Special thanks to the GMU Center for Collision Safety and Analysis (CCSA) for providing this high-quality open-source finite element model.
